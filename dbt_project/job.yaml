apiVersion: run.googleapis.com/v1
kind: Job
metadata:
  name: dbt-project
spec:
  template:
    spec:
      taskCount: 1
      template:
        spec:
          containers:
          - name: dbt-project-1
            image: $DOCKER_IMAGE
            env:
            - name: DBT_USE_COLORS
              value: "0"
            - name: GOOGLE_CLOUD_PROJECT
              value: $GOOGLE_CLOUD_PROJECT
            - name: GOOGLE_CLOUD_CLIENT_EMAIL
              value: $GOOGLE_CLOUD_CLIENT_EMAIL
            resources:
              limits:
                cpu: 1000m
                memory: 512Mi
          maxRetries: 0
          timeoutSeconds: 300
          serviceAccountName: $GOOGLE_CLOUD_SERVICE_ACCOUNT
